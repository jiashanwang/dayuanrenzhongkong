<?php
/*
 本代码由 成都大猿人网络科技有限公司 原创开发
 官方网址：www.dayuanren.cn
 严禁反编译、逆向等任何形式的侵权行为，违者将追究法律责任
*/

namespace app\agent\controller;use app\common\model\Product;use app\common\model\Product as ProductModel;use think\Request;use Util\GoogleAuth;class User extends Admin{public function infos(){if(Request::instance()->isPost())goto Kh9eWjgx2;goto Kh9ldMhx2;Kh9eWjgx2:M('customer')->where(array('id'=>$this->user['id']))->setField(array('headimg'=>I('headimg'),'ip_white_list'=>I('ip_white_list')));return $this->success("保存成功！");goto Kh9x1;Kh9ldMhx2:unset($Kh9tIMC);$Kh9tIMC=M('product_type')->where(array('status'=>1))->field('id,type_name,typec_id')->order('sort asc,id asc')->select();$types=$Kh9tIMC;foreach($types as $key=>&$type){unset($Kh9tIMC);$Kh9tIMC=ProductModel::getTypec($type['typec_id']);$typec=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=$typec;$type['typec']=$Kh9tIMC;}unset($Kh9tIMC);$Kh9tIMC=M('customer')->find($this->user['id']);$info=$Kh9tIMC;$this->assign('info',$info);$this->assign('types',$types);return view();Kh9x1:}public function uppwd(){$Kh9MC=I('npwd')==I('ypwd');if($Kh9MC)goto Kh9eWjgx4;goto Kh9ldMhx4;Kh9eWjgx4:return $this->error("新密码不能与原密码相同");goto Kh9x3;Kh9ldMhx4:Kh9x3:$Kh9MC=I('npwd')!=I('npwd2');if($Kh9MC)goto Kh9eWjgx6;goto Kh9ldMhx6;Kh9eWjgx6:return $this->error("两次输入的新密码不相同");goto Kh9x5;Kh9ldMhx6:Kh9x5:$Kh9MC=!M('customer')->where(array('id'=>$this->user['id'],'password'=>dyr_encrypt(I('ypwd'))))->find();if($Kh9MC)goto Kh9eWjgx8;goto Kh9ldMhx8;Kh9eWjgx8:return $this->error("密码错误");goto Kh9x7;Kh9ldMhx8:Kh9x7:M('customer')->where(array('id'=>$this->user['id']))->setField(array('password'=>dyr_encrypt(I('npwd'))));session('user_auth_agent',null);return $this->success("修改成功！");}public function balance(){unset($Kh9tIMC);$Kh9tIMC=$this->user['id'];$map['customer_id']=$Kh9tIMC;if(I('style'))goto Kh9eWjgxa;goto Kh9ldMhxa;Kh9eWjgxa:unset($Kh9tIMC);$Kh9tIMC=I('style');$map['style']=$Kh9tIMC;goto Kh9x9;Kh9ldMhxa:Kh9x9:if(I('key'))goto Kh9eWjgxc;goto Kh9ldMhxc;Kh9eWjgxc:$Kh9vPMC='%' . I('key');$Kh9vPMD=$Kh9vPMC . '%';unset($Kh9tIME);$Kh9tIME=array('like',$Kh9vPMD);$map['remark']=$Kh9tIME;goto Kh9xb;Kh9ldMhxc:Kh9xb:$Kh9MC=(bool)I('end_time');if($Kh9MC)goto Kh9eWjgxf;goto Kh9ldMhxf;Kh9eWjgxf:$Kh9MC=I('end_time')&&I('begin_time');goto Kh9xe;Kh9ldMhxf:Kh9xe:if($Kh9MC)goto Kh9eWjgxg;goto Kh9ldMhxg;Kh9eWjgxg:unset($Kh9tIMC);$Kh9tIMC=array('between',array(strtotime(I('begin_time')),strtotime(I('end_time'))));$map['create_time']=$Kh9tIMC;goto Kh9xd;Kh9ldMhxg:Kh9xd:unset($Kh9tIMC);$Kh9tIMC=M('balance_log')->where($map)->order("id desc")->paginate(30);$list=$Kh9tIMC;$this->assign('_list',$list);return view();}public function day_balance(){unset($Kh9tIMC);$Kh9tIMC=$this->user['id'];$customer_id=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=array();$data=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=strtotime(date("Y-m-d",time()));$cusmonth=$Kh9tIMC;$i=0;Kh9xh:$Kh9MC=$i<31;if($Kh9MC)goto Kh9eWjgxl;goto Kh9ldMhxl;Kh9eWjgxl:$Kh9vPMC='-' . $i;$Kh9vPMD=$Kh9vPMC . ' day';unset($Kh9tIME);$Kh9tIME=strtotime($Kh9vPMD,$cusmonth);unset($Kh9tIMC);$Kh9tIMC=$Kh9tIME;$start_time=$Kh9tIMC;$Kh9MC=strtotime('+1 day',$start_time)-1;unset($Kh9tIMD);$Kh9tIMD=$Kh9MC;unset($Kh9tIMC);$Kh9tIMC=$Kh9tIMD;$end_time=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=date("Y-m-d",$start_time);$arr['date']=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=M('porder')->where(array('customer_id'=>$customer_id,'create_time'=>array('between',array($start_time,$end_time)),'status'=>array('not in',array(1,7))))->order('create_time asc,id asc')->count();$arr['dingdanshu']=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=M('porder')->where(array('customer_id'=>$customer_id,'create_time'=>array('between',array($start_time,$end_time)),'status'=>array('not in',array(1,7))))->order('create_time asc,id asc')->sum('total_price');$arr['dingdanprice']=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=M('porder')->where(array('customer_id'=>$customer_id,'finish_time'=>array('between',array($start_time,$end_time)),'status'=>array('in',array(4,9,12,13))))->order('finish_time asc,id asc')->count();$arr['cgdingdanshu']=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=M('porder')->where(array('customer_id'=>$customer_id,'finish_time'=>array('between',array($start_time,$end_time)),'status'=>array('in',array(4,9,12,13))))->order('finish_time asc,id asc')->sum('total_price - refund_price');$arr['cgprice']=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=M('balance_log')->where(array('customer_id'=>$customer_id,'create_time'=>array('between',array($start_time,$end_time)),'style'=>2,'type'=>1))->order('create_time asc,id asc')->sum('money');$arr['flprice']=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=M('balance_log')->where(array('create_time'=>array('egt',$start_time),'customer_id'=>$customer_id))->order('create_time asc,id asc')->value('balance_pr');$arr['qichu']=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=M('balance_log')->where(array('create_time'=>array('elt',$end_time),'customer_id'=>$customer_id))->order('create_time desc,id desc')->value('balance');$arr['qimo']=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=M('balance_log')->where(array('customer_id'=>$customer_id,'create_time'=>array('between',array($start_time,$end_time)),'type'=>1,'style'=>4))->sum('money');$arr['jiakuan']=$Kh9tIMC;unset($Kh9tIMC);$Kh9tIMC=$arr;$data[]=$Kh9tIMC;Kh9xi:$Kh9oB218=$i;$Kh9oB219=$i+1;$i=$Kh9oB219;goto Kh9xh;goto Kh9xk;Kh9ldMhxl:Kh9xk:Kh9xj:$this->assign('_list',$data);return view();}}
?>