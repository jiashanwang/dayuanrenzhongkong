<?php
/*
 本代码由 成都大猿人网络科技有限公司 原创开发
 官方网址：www.dayuanren.cn
 严禁反编译、逆向等任何形式的侵权行为，违者将追究法律责任
*/

namespace app\common\command;use app\common\library\Configapi;use app\common\library\Notification;use app\common\library\SmsNotice;use app\common\model\Client;use app\common\model\Porder;use think\console\Command;use think\console\Input;use think\console\Output;class Crontab60 extends Command{protected function configure(){$this->setName('Crontab60')->setDescription('60秒定时器');}protected function execute(Input $input,Output $output){Kh9x1:if(1)goto Kh9eWjgx4;goto Kh9ldMhx4;Kh9eWjgx4:C(Configapi::getconfig());Porder::delayTimeOrderSub();$this->notification();SmsNotice::agentBlalow();Porder::timeOutCancelOrder();Porder::jiemaCheckOrder();SmsNotice::porderSusNotice();$Kh9MC="执行完成！" . date("Y-m-d H:i:s",time());$Kh9MD=$Kh9MC . PHP_EOL;echo $Kh9MD;sleep(60);goto Kh9x1;goto Kh9x3;Kh9ldMhx4:Kh9x3:Kh9x2:}private function notification(){$Kh9vPvPvPMC=60*5;$Kh9vPvPvPMD=time()-$Kh9vPvPvPMC;unset($Kh9tIME);$Kh9tIME=M('porder')->where(array('status'=>array('in','4,5,6,13'),'client'=>Client::CLIENT_API,'is_notification'=>0,'notification_num'=>array('elt',4),'finish_time'=>array('elt',$Kh9vPvPvPMD)))->field("id,status,notification_num,notification_time")->select();$lists=$Kh9tIME;foreach($lists as $k=>$v){$Kh9MC=$v['notification_num']>0;$Kh9MH=(bool)$Kh9MC;if($Kh9MH)goto Kh9eWjgx7;goto Kh9ldMhx7;Kh9eWjgx7:$Kh9MD=$v['notification_num']*$v['notification_num'];$Kh9ME=$Kh9MD*60;$Kh9MF=time()-$Kh9ME;$Kh9MG=$v['notification_time']>$Kh9MF;$Kh9MH=$Kh9MC&&$Kh9MG;goto Kh9x6;Kh9ldMhx7:Kh9x6:if($Kh9MH)goto Kh9eWjgx8;goto Kh9ldMhx8;Kh9eWjgx8:continue 1;goto Kh9x5;Kh9ldMhx8:Kh9x5:$Kh9MC=$v['status']==4;if($Kh9MC)goto Kh9eWjgxa;goto Kh9ldMhxa;Kh9eWjgxa:Notification::rechargeSus($v['id']);goto Kh9x9;Kh9ldMhxa:$Kh9MC=$v['status']==13;if($Kh9MC)goto Kh9eWjgxb;goto Kh9ldMhxb;Kh9eWjgxb:Notification::rechargePart($v['id']);goto Kh9x9;Kh9ldMhxb:Notification::rechargeFail($v['id']);Kh9x9:}}}
?>